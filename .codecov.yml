# Codecov configuration for Pentora
# https://docs.codecov.com/docs/codecov-yaml

# Coverage targets
coverage:
  status:
    project:
      default:
        target: 70% # Realistic baseline (current: 67.3%, gradual improvement expected)
        threshold: 2% # Allow 2% decrease for refactoring flexibility
        informational: false # Block PRs that decrease coverage significantly
    patch:
      default:
        target: 85% # High standard for new code (achievable, see pkg/plugin: 96.5%)
        threshold: 5% # Allow 5% decrease for major refactoring/architecture changes
        informational: false # Enforce quality on new code

  # Ignore paths that don't need coverage
  ignore:
    # CLI entry points - thin wrappers around pkg/
    - 'cmd/**/*.go'

    # CLI command implementations - integration tested
    - 'pkg/cli/**/*.go'

    # Generated code
    - '**/*.pb.go' # Protobuf generated files
    - '**/*_generated.go' # Any generated Go files
    - 'pkg/engine/proto/**' # Protocol buffer definitions

    # Not yet implemented / future work
    - 'pkg/api/dashboard/**'
    - 'pkg/fingerprint/catalogsync/**'

    # Test files (already excluded by default but explicit)
    - '**/*_test.go'
    - '**/testdata/**'
    - '**/mock_*.go'

# Comment behavior on PRs
comment:
  layout: 'diff, flags, files'
  behavior: default
  require_changes: false
  require_base: false
  require_head: true

# Flags for different components (optional)
flags:
  unit:
    paths:
      - pkg/
    carryforward: true
  integration:
    paths:
      - pkg/server/
    carryforward: true

# Coverage improvement roadmap
# Current (v0.1-dev): project 70%, patch 85%
# Phase 2 (v0.2): project 75%, patch 85%
# Phase 3 (v0.3): project 80%, patch 90%
# Phase 4 (v1.0): project 85%, patch 90%
# Gradual improvement with each release cycle
