name: SSH Weak Key Exchange Algorithm
version: 1.0.0
type: evaluation
author: pentora-security

metadata:
  severity: medium
  tags: [ssh, crypto, weak-crypto, key-exchange]
  references:
    - https://www.ssh.com/academy/ssh/kex
    - https://nvd.nist.gov/vuln/detail/CVE-2020-14145

# Trigger when SSH key exchange algorithms are detected
triggers:
  - data_key: ssh.kex_algorithms
    condition: exists
    value: true

# Detect weak key exchange algorithms
match:
  logic: OR
  rules:
    - field: ssh.kex_algorithms
      operator: contains
      value: "diffie-hellman-group1-sha1"
    - field: ssh.kex_algorithms
      operator: contains
      value: "diffie-hellman-group-exchange-sha1"
    - field: ssh.kex_algorithms
      operator: contains
      value: "diffie-hellman-group14-sha1"

output:
  vulnerability: true
  severity: medium
  message: "SSH server supports weak key exchange algorithms (SHA-1 based)"
  remediation: "Disable SHA-1 based key exchange algorithms. Use curve25519-sha256, ecdh-sha2-nistp256, or diffie-hellman-group-exchange-sha256"
  reference: "https://www.ssh.com/academy/ssh/kex"
